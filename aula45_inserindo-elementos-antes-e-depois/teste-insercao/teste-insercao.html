<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste inserção</title>
    <link rel="stylesheet" href="teste-insercao.css">
</head>
<body>
    <div class="conteiner conteiner-entradas">
        <h1>Lista de cursos</h1>
        <label for="input-nome">Inserir curso: </label>
        <input type="text" id="input-nome">
        <input type="button" value="inserir" class="btn" id="btn-inserir">
        <input type="button" value="Inserir antes de" class="btn" id="btn-inserir-antes">
        <input type="button" value="Inserir depois de" class="btn" id="btn-inserir-depois">
        <input type="button" value="Curso selecionado" class="btn" id="btn-selecionar">
        <input type="button" value="Remover" class="btn" id="btn-remover">
    </div>
    <div class="conteiner conteiner-cursos"></div>
</body>
<script>
    const btnSelecionar = document.querySelector("#btn-selecionar");
    const btnRemover = document.querySelector("#btn-remover");
    const btnInserir =  document.querySelector("#btn-inserir");
    const btnInserirAntes = document.querySelector("#btn-inserir-antes");
    const btnInserirDepois= document.querySelector("#btn-inserir-depois");
  
    const conteiners = document.querySelectorAll(".curso");
    const conteinerCursos = document.querySelector(".conteiner-cursos");
    const cursos = ["Javascript","PHP", "Java", "MySQL", "React"];

    const criarCurso = (nome, indice) =>{
        const divCurso = document.createElement("div");
        const label = document.createElement("label");
        const radio = document.createElement("input");
        const radioId = "opt"+(indice+1);

        divCurso.setAttribute("class", "curso");
        radio.setAttribute("type", "radio")
        radio.setAttribute("name","opt");
        radio.setAttribute("id", radioId);
        label.setAttribute("for",radioId);
        label.textContent = nome;

        divCurso.appendChild(radio);
        divCurso.appendChild(label);
        divCurso.addEventListener("click", (evt)=>{
            //marca o radio ao clicar no conteiner
            //evt.target -> elemento alvo do evento, a div curso no caso
            const radio = evt.target.querySelector("input[type='radio']");
            radio.checked = true;
        });
        return divCurso;
    }

    cursos.map((curso, i)=>{
        conteinerCursos.appendChild(criarCurso(curso, i));
    });

    const obterRadioSelecionado = ()=>{
        const radios = [...document.querySelectorAll("input[type='radio']")]; // converte NodeList em Array.
        const radioSelecionado = radios.filter((radio)=>radio.checked)[0];
        // filter retorna um array com apenas um radio
        return radioSelecionado;
    }

    btnSelecionar.addEventListener("click", (evt)=>{
        const radioSelecionado = obterRadioSelecionado(); 
        if(radioSelecionado){
            const cursoTxt = radioSelecionado.nextElementSibling.textContent;// o texto do label é um DOM node do tipo objectText, usa-se a propriedade textContent pra obter sua string.

            window.alert('Curso selecionado: ' + cursoTxt);
        }
        else{
            window.alert('Nenhum curso foi selecionado.');
        }
    });

    btnRemover.addEventListener("click", (evt)=>{
        const radioSelecionado = obterRadioSelecionado();
        if(radioSelecionado){
            radioSelecionado.parentElement.remove();
        }
        else{
            window.alert('Selecione um curso para remover.');
        }
    });

    btnInserir.addEventListener("click", (evt)=>{
        const nomeCurso = document.querySelector("#input-nome").value;
        if(nomeCurso){
            if(!cursos.includes(nomeCurso)){
                conteinerCursos.appendChild(criarCurso(nomeCurso, cursos.length));
                cursos.push(nomeCurso);   
            }
            else{
                window.alert("O curso já existe na lista.");
            }
            
        }
        else{
            window.alert("Insira o nome do curso");
        }
    });
    
    btnInserirAntes.addEventListener("click", (evt)=>{
        try{
            const cursoRef = obterRadioSelecionado().parentElement;
            const nomeCurso =  document.querySelector("#input-nome").value;
            if(nomeCurso){
                if(!cursos.includes(nomeCurso)){
                    conteinerCursos.insertBefore(criarCurso(nomeCurso, cursos.length),cursoRef);
                    cursos.push(nomeCurso);
                }
                else{
                    window.alert("O curso já existe na lista.");
                }
            }
            else{
                window.alert("Insira o nome do curso.");
            }
        }
        catch{
            window.alert("Nenhum curso foi selecionado");
        }
    });

    btnInserirDepois.addEventListener("click", (evt)=>{
        try{
            const cursoRefProx = obterRadioSelecionado().parentElement.nextSibling;
            const nomeCurso = document.querySelector("#input-nome").value;
            if(nomeCurso){
                if(!cursos.includes(nomeCurso)){
                    conteinerCursos.insertBefore(criarCurso(nomeCurso, cursos.length), cursoRefProx);
                    cursos.push(nomeCurso);
                }
                else{
                    window.alert("O curso já existe na lista.");
                }
            }
            else{
                window.alert("Insira o nome do curso");
            }
        }
        catch{
            window.alert("Nenhum curso foi selecionado.");
        }
    });
</script>
</html>